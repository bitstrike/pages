<!--

javascript clock with fluid rotation

step-by-step, consider the specification and attached code below to refactor a cyberpunk html themed javascript clock that consists of 3 circles. The centers of all circles align at the same x,y location. The minute and second circles rotate around the same origin as the hour circle location. The generated code should all be contained within one html file.


    The innermost circle does shows the current hour in 2 digit format in the center. The hours are displayed as bold numerals.

    The next circle is centered at the same location as the hour circle, but is large enough in diameter to contain numbers around it's outside edge from 00-55. This circle. has 60 equidistant tick marks on it's edge with the numbers placed every 5 ticks. 'This circle is like a "minute doughnut". which sweeps through a full revolution every hour. The minute doughnut sweeps one full mark every 60 seconds.

    The third circle is the "second doughnut". This doughnut is also centered at the hour location and is larger in diameter than the minute doughnut. The second doughnut is numbered also 00-55 with 60 tickmarks around it's edge. The second doughnut rotates on mark every second but in a sweeping fashion so as to be constantly moving.

    The minute and second circles synchronize at the 3 o'clock position to show the current minute and second.

    Fixed at the 3 o'clock position will be a translucent indicator to provide a reference for where the reading for the current time can be taken.

    randomly every 10 seconds, a small-particle animiation should be animated at a randomized point around the clock where the rings contact each other to simulate a small shower of sparks coming from the grinding of the rings rubbing together. The sparks should be light yellowish in color and decay as they spread part, but be somewhat translucent so not to be distracting.

    provide comments in the code to explain what blocks of code are doing and why they are needed

    Behind the clock, a vertical Matrix style display of randomized lettering should slowly scroll down the screen using a cyberpunk font for the lettering. The lettering should be also translucent so as not to be distracting from the clock display.


Colors to select from for the theme are:

Neon Cyan	#00FFFF	Bright, electric cyan
Neon Pink	#FF00FF	Vivid magenta/pink
Electric Blue	#00B8FF	Intense, glowing blue
Vivid Sky Blue	#03D8F3	Bright, almost neon blue
Acid Yellow	#F2E900	Bright, eye-catching yellow
Aureolin	#FCEE0C	Neon yellow
Hot Red	#FF1111	Strong, saturated red
Deep Purple	#8000FF	Bold, glowing purple
Cyberpunk Green	#00FF9F	Neon green with blue tint
Black	#000000	Deep, dark background
Vibrant Purple	#BD00FF	Electric, saturated purple
Magenta-Purple	#D600FF	Bright magenta-purple
Intense Purple	#5E00FF	Deep, saturated purple
Moody Purple	#2F006F	Dark, moody purple for backgrounds
Luminous Purple	#9D00FF	Bold, luminous purple for highlights
Vivid Violet	#7F00FF	Classic vivid violet, great for neon lines
!-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T3h Chr0n0m0m3t3r</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Share+Tech+Mono&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: radial-gradient(circle at center, #0c0d1d, #070813, #03030a);
            font-family: 'Orbitron', sans-serif;
            overflow: hidden;
            position: relative;
            color: #00FF9F; /* Cyberpunk Green */
        }
        
        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 159, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 159, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            z-index: 1;
        }
        
        .matrix-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.3;
            z-index: 2;
        }
        
        .matrix-track {
            position: absolute;
            top: -100%;
            left: 0;
            font-family: 'Share Tech Mono', monospace;
            color: rgba(0, 255, 159, 0.3);
            font-size: 16px;
            writing-mode: vertical-rl;
            height: 150%;
            text-shadow: 0 0 10px rgba(0, 255, 159, 0.4);
            animation: slideDown linear infinite;
        }
        
        .title {
            position: absolute;
            top: 30px;
            text-align: center;
            color: #7F00FF; /* Vibrant Violet */
            font-size: 3rem;
            letter-spacing: 8px;
            text-shadow: 0 0 20px #7F00FF, 0 0 40px #7F00FF;
            font-weight: 700;
            text-transform: uppercase;
            z-index: 10;
        }
        
        .clock-container {
            position: relative;
            width: 480px;
            height: 480px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5;
        }
        
        .circle {
            position: absolute;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.05s cubic-bezier(0.3, 0, 0.7, 1);
        }
        
        .hour-circle {
            width: 140px;
            height: 140px;
            background: rgba(0, 15, 10, 0.8);
            border: 3px solid #FF00D4; /* Neon Pink */
            box-shadow: 
                0 0 20px #FF00D4, 
                inset 0 0 10px #FF00D4;
            z-index: 15;
            animation: hourPulse 3600s infinite ease-in-out;
        }
        
        .hour-display {
            font-size: 48px;
            font-weight: 900;
            color: #FF00D4;
            text-shadow: 0 0 20px #FF00D4;
            letter-spacing: -2px;
        }
        
        .donut {
            background: none;
            border-width: 2px;
            border-style: solid;
        }
        
        .minute-donut {
            width: 340px;
            height: 340px;
            border-color: #00B8FF; /* Electric Blue */
            box-shadow: 
                0 0 25px rgba(0, 184, 255, 0.9), 
                inset 0 0 10px rgba(0, 184, 255, 0.7);
            z-index: 14;
        }
        
        .second-donut {
            width: 440px;
            height: 440px;
            border-color: #F2E900; /* Acid Yellow */
            box-shadow: 
                0 0 25px rgba(242, 233, 0, 0.7), 
                inset 0 0 10px rgba(242, 233, 0, 0.5);
            z-index: 13;
        }
        
        .ticks {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }
        
        .tick {
            position: absolute;
            left: 50%;
            transform-origin: bottom center;
        }
        
        .minute-tick {
            width: 4px;
            height: 16px;
            background: #00B8FF;
            transform: translateX(-50%);
        }
        
        .minute-tick.minor {
            height: 10px;
            background: rgba(0, 184, 255, 0.6);
        }
        
        .second-tick {
            width: 2px;
            height: 14px;
            background: rgba(242, 233, 0, 0.7);
            transform: translateX(-50%);
        }
        
        .number {
            position: absolute;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 0 0 8px currentColor;
            transform-origin: center center;
            pointer-events: none;
        }
        
        .minute-num {
            color: #00B8FF; /* Electric Blue */
            font-size: 18px;
        }
        
        .second-num {
            color: #F2E900; /* Acid Yellow */
            font-size: 14px;
        }
        
        .tick-container {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            transform-origin: center;
        }
        
        @keyframes hourPulse {
            0%, 100% { box-shadow: 0 0 15px #FF00D4, inset 0 0 10px #FF00D4; }
            50% { box-shadow: 0 0 30px #FF00D4, 0 0 40px rgba(255, 0, 212, 0.5), inset 0 0 15px #FF00D4; }
        }
        
        .digital {
            position: absolute;
            bottom: 60px;
            width: 300px;
            color: rgba(255, 255, 255, 0.95);
            font-family: 'Share Tech Mono', monospace;
            font-size: 28px;
            letter-spacing: 8px;
            text-align: center;
            text-shadow: 0 0 15px #00FF9F; /* Cyberpunk Green */
            background: rgba(0, 15, 22, 0.6);
            padding: 20px 40px;
            border-radius: 10px;
            border: 2px solid #00FF9F;
            box-shadow: 0 0 30px #00FF9F;
            backdrop-filter: blur(6px);
            z-index: 10;
        }
        
        .target-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 440px;
            height: 440px;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 20;
        }
        
        .target-reticle {
            position: absolute;
            top: 50%;
            right: -60px;
            transform: translateY(-50%);
            z-index: 20;
            width: 240px;
            height: 80px;
        }
        
        .target-line {
            position: absolute;
            height: 4px;
            background: linear-gradient(90deg, transparent, #00FF9F 70%);
            box-shadow: 0 0 25px #00FF9F;
            border-radius: 2px;
            top: 50%;
            left: 30px;
            transform: translateY(-50%);
            width: 140px;
        }
        
        .target-diamond {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #00FF9F; /* Cyberpunk Green */
            box-shadow: 0 0 30px #00FF9F;
            transform: translateY(-50%) rotate(45deg);
            top: 50%;
            left: 159px;
            animation: scanPulse 2s infinite;
        }
        
        @keyframes scanPulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 159, 0.8); }
            70% { box-shadow: 0 0 0 20px rgba(0, 255, 159, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 159, 0); }
        }
        
        .corner-glow {
            position: fixed;
            width: 60px;
            height: 60px;
            border: 3px solid;
            box-shadow: 0 0 25px;
            z-index: 5;
        }
        
        .corner-tl {
            top: 30px;
            left: 30px;
            border-color: #FF00D4; /* Neon Pink */
            box-shadow: 0 0 30px #FF00D4;
            border-right: none;
            border-bottom: none;
        }
        
        .corner-tr {
            top: 30px;
            right: 30px;
            border-color: #7F00FF; /* Vibrant Violet */
            box-shadow: 0 0 30px #7F00FF;
            border-left: none;
            border-bottom: none;
        }
        
        .corner-bl {
            bottom: 30px;
            left: 30px;
            border-color: #00B8FF; /* Electric Blue */
            box-shadow: 0 0 30px #00B8FF;
            border-right: none;
            border-top: none;
        }
        
        .corner-br {
            bottom: 30px;
            right: 30px;
            border-color: #F2E900; /* Acid Yellow */
            box-shadow: 0 0 30px #F2E900;
            border-left: none;
            border-top: none;
        }
        
        .border-animate {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 3;
        }
        
        .line {
            position: absolute;
        }
        
        .top-line {
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #FF00D4, transparent);
            box-shadow: 0 0 15px #FF00D4;
            animation: slideLine 5s linear infinite;
        }
        
        .right-line {
            top: -100%;
            right: 0;
            height: 100%;
            width: 2px;
            background: linear-gradient(180deg, transparent, #00B8FF, transparent);
            box-shadow: 0 0 15px #00B8FF;
            animation: slideLine 7s linear infinite;
            animation-delay: 1.25s;
        }
        
        .bottom-line {
            bottom: 0;
            right: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #7F00FF, transparent);
            box-shadow: 0 0 15px #7F00FF;
            animation: slideLine 5s linear infinite;
            animation-delay: 2.5s;
        }
        
        .left-line {
            bottom: -100%;
            left: 0;
            height: 100%;
            width: 2px;
            background: linear-gradient(180deg, transparent, #00FF9F, transparent);
            box-shadow: 0 0 15px #00FF9F;
            animation: slideLine 7s linear infinite;
            animation-delay: 3.75s;
        }
        
        @keyframes slideLine {
            0% { transform: translateX(0); }
            100% { transform: translateX(200%); }
        }
        
        .spark-container {
            position: absolute;
            pointer-events: none;
            z-index: 30;
            height: 100%;
            width: 100%;
        }
        
        .spark {
            position: absolute;
            border-radius: 50%;
            background: #FFFF73; /* Light yellowish color for sparks */
            box-shadow: 0 0 10px #FFFF73, 0 0 20px #FFFF73;
            transform: translate(-50%, -50%);
        }
        
        @keyframes sparkAnimation {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            80% {
                opacity: 0.6;
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(4);
                filter: blur(10px);
            }
        }
        
        @keyframes slideDown {
            to { transform: translateY(100%); }
        }
    </style>
</head>
<body>
    <div id="matrix-container" class="matrix-container"></div>
    <div class="grid-overlay"></div>
    <div class="title">Chr0n0M0m3t3r</div>
    <div class="corner-glow corner-tl"></div>
    <div class="corner-glow corner-tr"></div>
    <div class="corner-glow corner-bl"></div>
    <div class="corner-glow corner-br"></div>
    <div class="border-animate">
        <div class="line top-line"></div>
        <div class="line right-line"></div>
        <div class="line bottom-line"></div>
        <div class="line left-line"></div>
    </div>
    
    <div class="clock-container">
        <div class="circle second-donut donut">
            <div id="second-ticks" class="ticks"></div>
        </div>
        <div class="circle minute-donut donut">
            <div id="minute-ticks" class="ticks"></div>
        </div>
        <div class="circle hour-circle">
            <div class="hour-display">00</div>
        </div>
        <div class="target-overlay">
            <div class="target-reticle">
                <div class="target-line"></div>
                <div class="target-diamond"></div>
            </div>
        </div>
        <div id="spark-overlay" class="spark-container"></div>
    </div>
    
    <div class="digital" id="digital-clock">00:00:00</div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // DOM elements initialization
            const clockElements = {
                hourDisplay: document.querySelector('.hour-display'),
                minuteTicks: document.getElementById('minute-ticks'),
                secondTicks: document.getElementById('second-ticks'),
                digitalClock: document.getElementById('digital-clock'),
                sparkOverlay: document.getElementById('spark-overlay'),
                matrixContainer: document.getElementById('matrix-container'),
                minuteDonut: document.querySelector('.minute-donut'),
                secondDonut: document.querySelector('.second-donut')
            };

            // Time tracking variables
            let lastParticleTime = 0;
            let lastRandomSpark = Date.now();
            let lastSecondRotation = 0;      // for tracking direction of rotation (wrapping)
            let lastMinuteRotation = 0;      // for tracking direction of rotation (wrapping)
            
            // Matrix rain effect for background
            function createMatrixEffect() {
                const chars = "01!@$%&*ÑæÆØPÊƒÜÖç";
                const trackCount = Math.floor(window.innerWidth / 32);
                
                for(let i = 0; i < trackCount; i++) {
                    const track = document.createElement('div');
                    track.className = 'matrix-track';
                    track.style.left = (i * 32) + 'px';
                    track.style.animation = `slideDown ${Math.random()*20 + 50}s linear infinite`;
                    track.style.animationDelay = Math.random() * 30 + 's';
                    
                    // Create content for rain column
                    let content = '';
                    const length = 100;
                    for(let j = 0; j < length; j++) {
                        content += (Math.random() > 0.15) ? 
                            chars.charAt(Math.floor(Math.random() * chars.length)) : ' ';
                    }
                    track.textContent = content;
                    clockElements.matrixContainer.appendChild(track);
                }
            }

            // Create circular tick marks for minutes and seconds
            function createClockMarkings(container, options) {
                var padding = 5;
                for (let i = 0; i < 60; i++) {
                    // For major ticks (every 5 units) create numbers and ticks
                    const isMajor = i % 5 === 0;
                    if (isMajor) {
                        const num = document.createElement('div');
                        num.className = `number ${options.numberClass}`;
                        num.textContent = i.toString().padStart(2, '0'); // start with 00
                        num.style.top = (options.inset + padding) + 'px';          // 12px
                        num.style.left = '50%';                        
                        num.style.transform = 'translateX(-50%)';   
                        
                        const numContainer = document.createElement('div');
                        numContainer.className = 'tick-container';
                        numContainer.style.transform = `rotate(${i * 6}deg)`;
                        numContainer.appendChild(num);
                        container.appendChild(numContainer);
                    }
                    
                    // Create the actual tick marks
                    const tick = document.createElement('div');
                    tick.className = `tick ${options.tickClass} ${!isMajor ? 'minor' : ''}`;
                    tick.style.top = '0';
                    tick.style.transformOrigin = `center ${options.radius}px`;
                    
                    const tickContainer = document.createElement('div');
                    tickContainer.className = 'tick-container';
                    tickContainer.style.transform = `rotate(${i * 6}deg)`;
                    tickContainer.appendChild(tick);
                    container.appendChild(tickContainer);
                }
            }

            // Create spark effect at a specific angle around the clock
            function createSpark(angle) {
                // Positioning parameters
                const centerX = 240;
                const centerY = 240;
                const secondRadius = 220;
                
                // Calculate spawn position
                const radian = angle * Math.PI / 180;
                const startX = centerX + secondRadius * Math.cos(radian);
                const startY = centerY + secondRadius * Math.sin(radian);
                
                // Create spark container for this animation
                const sparkGroup = document.createElement('div');
                sparkGroup.className = 'spark-group';
                sparkGroup.style.position = 'absolute';
                sparkGroup.style.left = startX + 'px';
                sparkGroup.style.top = startY + 'px';
                clockElements.sparkOverlay.appendChild(sparkGroup);
                
                // Generate 10-15 spark particles with random properties
                const count = Math.floor(Math.random() * 6) + 10;
                for (let i = 0; i < count; i++) {
                    const size = Math.random() * 4 + 2;
                    const spark = document.createElement('div');
                    spark.className = 'spark';
                    spark.style.width = `${size}px`;
                    spark.style.height = `${size}px`;
                    spark.style.opacity = (Math.random() * 0.6 + 0.4).toFixed(2);
                    
                    // Set random starting position variations
                    spark.style.left = `${Math.random() * 60 - 30}px`;
                    spark.style.top = `${Math.random() * 60 - 30}px`;
                    
                    // Create random animation parameters
                    const animDist = Math.random() * 60 + 30;
                    const animAngle = Math.random() * Math.PI * 2;
                    const endX = Math.cos(animAngle) * animDist;
                    const endY = Math.sin(animAngle) * animDist;
                    
                    // Apply spark animation
                    const anim = spark.animate([
                        { transform: 'translate(0, 0)' },
                        { transform: `translate(${endX}px, ${endY}px)` }
                    ], {
                        duration: Math.random() * 500 + 800,
                        easing: 'ease-out'
                    });
                    
                    // Spark group management
                    sparkGroup.appendChild(spark);
                    anim.onfinish = () => {
                        spark.remove();
                        if (sparkGroup.children.length === 0) {
                            sparkGroup.remove();
                        }
                    };
                }
                
                // Remove spark group if no particles remain (cleanup)
                setTimeout(() => {
                    sparkGroup.remove();
                }, 1500);
            }

            // Timer-based spark generator
            function triggerRandomSparks() {
                const currentTime = Date.now();
                // Generate a spark every 8-12 seconds
                if (currentTime - lastRandomSpark > Math.random() * 4000 + 8000) {
                    lastRandomSpark = currentTime;
                    const angle = Math.random() * 360;
                    createSpark(angle);
                }
            }

            function rotationFix(rawRotation, lastRotation) {
                if (rawRotation < lastRotation - 180) {
                    // Crossing 360° boundary clockwise
                    return rawRotation + 360;
                } else if (rawRotation > lastRotation + 180) {
                    // Crossing 360° boundary counter-clockwise
                    return rawRotation - 360;
                }
                return rawRotation;
            }

            // Update the clock hands and time displays
            function updateClock() {
                const now = new Date();
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const seconds = now.getSeconds();
                const milliseconds = now.getMilliseconds();
                
                // Convert to 12-hour display
                const displayHours = hours % 12 || 12;
                clockElements.hourDisplay.textContent = displayHours.toString().padStart(2, '0');

                // Calculate raw rotations
                const rawMinuteRotation = 90 - (minutes * 6 + seconds * 0.1);
                const rawSecondRotation = 90 - (seconds * 6 + milliseconds * 0.006);
    
                // Apply rotation fix to both hands
                const smoothMinuteRotation = rotationFix(rawMinuteRotation, lastMinuteRotation);
                const smoothSecondRotation = rotationFix(rawSecondRotation, lastSecondRotation);
    
                
                // Apply transforms
                clockElements.minuteDonut.style.transform = `rotate(${smoothMinuteRotation}deg)`;
                clockElements.secondDonut.style.transform = `rotate(${smoothSecondRotation}deg)`;
                
                // Update digital clock
                clockElements.digitalClock.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Trigger occasional sparks
                triggerRandomSparks();
                
                // Update last rotation for next frame
                lastSecondRotation = smoothSecondRotation;
                lastMinuteRotation = smoothMinuteRotation;

                // Continue animation loop
                requestAnimationFrame(updateClock);
            }
            // Initialize the clock
            function init() {
                createClockMarkings(clockElements.minuteTicks, {
                    numberClass: 'minute-num',
                    tickClass: 'minute-tick',
                    inset: 12,
                    radius: 170
                });
                
                createClockMarkings(clockElements.secondTicks, {
                    numberClass: 'second-num',
                    tickClass: 'second-tick',
                    inset: 15,
                    radius: 220
                });
                
                createMatrixEffect();
                updateClock();
            }

            // Start the clock
            init();
        });
    </script>
</body>
</html>

